version: '3'

tasks:
    default:
        dir: .
        cmds:
            - go mod download
            - go mod tidy
            - go mod verify
            - go fmt .
            - go vet .
            - go clean .
            - task: build
            - stampy
        silent: false

    go_build:
        - rm -rf ./build
        - mkdir ./build
        - go build -o ./build .
        - ./build/stampy

    rm_deb:
      ignore_error: true
      cmds:
      - sudo dpkg -r stampy -y
    snapshot_build:
      - goreleaser --snapshot --clean
    build:
      deps:
        - rm_deb
        - snapshot_build
      cmds:
        - sudo dpkg -i $(find dist/*amd64.deb)

    install-hooks:
        cmds:
#            - pip install pre-commit
#            - pip install --upgrade pre-commit
            - pre-commit install
    remove-hooks:
        ignore_error: true
        cmds:
            - pre-commit uninstall
            - rm .git/hooks -rf
